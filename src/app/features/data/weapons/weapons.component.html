<div class="join w-full mb-4">
  <input
    type="text"
    [placeholder]="'weapons.search' | transloco"
    class="input input-bordered join-item flex-1"
    [value]="searchTerm()"
    (input)="onSearch($any($event.target).value)"
  />
  <button class="btn btn-primary join-item" (click)="onRefresh()">
    @if (loading()) {
      <span class="loading loading-spinner"></span>
    }
    {{ 'weapons.refresh' | transloco }}
  </button>
</div>

<!-- Advanced Search Panel -->
<div class="collapse collapse-arrow bg-base-200 mb-4">
  <input
    type="checkbox"
    [checked]="showAdvancedSearch()"
    (change)="toggleAdvancedSearch()"
  />
  <div class="collapse-title text-lg font-medium">
    {{ 'weapons.advancedSearch' | transloco }}
  </div>
  <div class="collapse-content">
    <div class="text-sm opacity-70 mb-2">
      {{ 'weapons.filters.damage' | transloco }}, {{ 'weapons.filters.fireRate' | transloco }}, etc.
    </div>
    <button class="btn btn-ghost btn-sm" (click)="onClearFilters()">
      {{ 'weapons.clearFilters' | transloco }}
    </button>
  </div>
</div>

<!-- Error Alert -->
@if (hasError()) {
  <div class="alert alert-error mb-4">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="stroke-current shrink-0 h-6 w-6"
      fill="none"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    <span>{{ error() }}</span>
  </div>
}

<!-- Loading State -->
@if (loading()) {
  <div class="alert alert-info mb-4">
    <span class="loading loading-spinner"></span>
    <span>{{ 'weapons.scanning' | transloco }}</span>
  </div>
}

<!-- Weapons Table -->
<div class="overflow-x-auto">
  <table class="table table-xs">
    <thead>
      <tr>
        @for (col of getVisibleColumns(); track col.key) {
          <th [class.text-right]="col.alignment === 'right'">
            {{ col.i18nKey | transloco }}
          </th>
        }
      </tr>
    </thead>
    <tbody>
      @if (weaponCount() === 0) {
        <tr>
          <td
            [colSpan]="getVisibleColumns().length"
            class="text-center"
          >
            {{ 'weapons.noWeapons' | transloco }}
          </td>
        </tr>
      } @else {
        @for (weapon of weapons(); track weapon.key) {
          <tr class="cursor-pointer hover" (click)="onRowClick(weapon)">
            @for (col of getVisibleColumns(); track col.key) {
              <td
                [class.text-right]="col.alignment === 'right'"
                [class.text-left]="col.alignment === 'left'"
              >
                @if (col.field === 'filePath') {
                  <div class="flex items-center gap-1">
                    <span class="text-xs font-mono truncate flex-1" [title]="weapon.filePath">
                      {{ weapon.filePath }}
                    </span>
                    <button
                      class="btn btn-ghost btn-xs btn-circle"
                      [title]="'weapons.actions.openInEditor' | transloco"
                      (click)="$event.stopPropagation(); onOpenInEditor(weapon)"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                      </svg>
                    </button>
                    <button
                      class="btn btn-ghost btn-xs btn-circle"
                      [title]="'weapons.actions.copyPath' | transloco"
                      (click)="$event.stopPropagation(); onCopyPath(weapon)"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                      </svg>
                    </button>
                  </div>
                } @else if (col.field === 'key' || col.field === 'name') {
                  {{ weapon[col.field] }}
                } @else if (col.field === 'classTag') {
                  {{ weapon.classTag }}
                } @else if (col.field === 'magazineSize') {
                  {{ weapon.magazineSize }}
                } @else if (col.field === 'killProbability') {
                  {{ weapon.killProbability }}
                } @else if (col.field === 'retriggerTime') {
                  {{ weapon.retriggerTime }}
                } @else {
                  {{ weapon[col.field] }}
                }
              </td>
            }
          </tr>
        }
      }
    </tbody>
  </table>
  <div class="text-sm text-opacity-50 mt-2">
    {{ 'weapons.weaponCount' | transloco : { count: weaponCount() } }}
  </div>
</div>
