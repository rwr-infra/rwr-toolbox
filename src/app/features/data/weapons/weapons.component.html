<div class="control-area">
    <!-- Search and Filter Group -->
    <div class="flex flex-1 gap-2 min-w-[300px]">
        <div class="join w-full">
            <div
                class="join-item flex items-center bg-base-100 border border-base-300 px-3"
            >
                <i-lucide name="search" class="h-4 w-4 opacity-50"></i-lucide>
            </div>
            <input
                type="text"
                [placeholder]="'weapons.search' | transloco"
                class="input input-bordered input-sm join-item flex-1"
                [(ngModel)]="searchTerm"
                (ngModelChange)="onSearch($event)"
            />
            <select
                class="select select-bordered select-sm join-item w-40"
                (change)="onTagFilter($any($event.target).value)"
            >
                <option value="">
                    {{ 'weapons.filters.allTags' | transloco }}
                </option>
                @for (tag of availableTags(); track tag) {
                    <option [value]="tag" [selected]="selectedTag() === tag">
                        {{ tag }}
                    </option>
                }
            </select>
        </div>
    </div>

    <!-- Tools Group -->
    <div class="flex items-end gap-2">
        <!-- Page Size -->
        <div class="form-control">
            <label class="label py-0 h-4">
                <span class="label-text text-[10px] uppercase opacity-50">{{
                    'weapons.page_size' | transloco
                }}</span>
            </label>
            <select
                class="select select-bordered select-sm"
                [value]="pagination().pageSize"
                (change)="onPageSizeChange($event)"
            >
                @for (size of pageSizeOptions; track size) {
                    <option [value]="size">
                        {{ 'weapons.page_size_' + size | transloco }}
                    </option>
                }
            </select>
        </div>

        <!-- Column Toggle Dropdown -->
        <div class="dropdown dropdown-end">
            <div
                tabindex="0"
                role="button"
                class="btn btn-outline btn-sm"
                [title]="'weapons.column.selectColumns' | transloco"
            >
                <i-lucide name="settings-2" class="h-4 w-4"></i-lucide>
            </div>
            <ul
                tabindex="0"
                class="dropdown-content z-[30] menu p-2 shadow-lg bg-base-100 rounded-box w-52 border border-base-300"
            >
                <li class="menu-title">
                    <span class="text-[10px] uppercase opacity-50">{{
                        'weapons.column.selectColumns' | transloco
                    }}</span>
                </li>
                @for (col of columns; track col.key) {
                    <li>
                        <label
                            class="label cursor-pointer py-1 gap-2 justify-start"
                        >
                            <input
                                type="checkbox"
                                class="checkbox checkbox-xs checkbox-primary"
                                [checked]="isColumnVisible(col.key)"
                                [disabled]="isColumnDisabled(col.key)"
                                (change)="onColumnToggle(col.key)"
                            />
                            <span class="label-text text-xs">{{
                                col.i18nKey | transloco
                            }}</span>
                        </label>
                    </li>
                }
            </ul>
        </div>

        <!-- Scrolling Mode Toggle Button -->
        <button
            class="btn btn-outline btn-sm"
            (click)="toggleScrollingMode()"
            [title]="'scrolling.toggleTooltip' | transloco"
        >
            <i-lucide
                [name]="isTableOnlyMode() ? 'layout-list' : 'layout-grid'"
                class="h-4 w-4"
            ></i-lucide>
        </button>

        <!-- Refresh button -->
        <button class="btn btn-primary btn-sm" (click)="onRefresh()">
            @if (loading()) {
                <span class="loading loading-spinner h-4 w-4"></span>
            } @else {
                <i-lucide name="refresh-cw" class="h-4 w-4"></i-lucide>
            }
            {{ 'weapons.refresh' | transloco }}
        </button>
    </div>
</div>

<!-- Advanced Search Panel -->
<div
    class="bg-base-200/50 border border-base-300 mb-4 rounded-box overflow-hidden"
>
    <!-- Header Trigger -->
    <div
        (click)="toggleAdvancedSearch()"
        class="flex items-center justify-between p-4 cursor-pointer hover:bg-base-200/50 transition-colors"
    >
        <div class="text-sm font-medium flex items-center gap-2">
            <i-lucide name="layers" class="h-4 w-4 opacity-50"></i-lucide>
            {{ 'weapons.advancedSearch' | transloco }}
        </div>
        <i-lucide
            name="chevron-down"
            class="h-4 w-4 transition-transform duration-200"
            [class.rotate-180]="showAdvancedSearch()"
        ></i-lucide>
    </div>

    <!-- Animated Content Area -->
    <div [@expandCollapse]="showAdvancedSearch() ? 'expanded' : 'collapsed'">
        <div class="p-4 border-t border-base-300 overflow-visible">
            <!-- Range Filters -->
            <div
                class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 mb-4"
            >
                <!-- Damage Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{ 'weapons.filters.damage' | transloco }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="advancedFilters().damage?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'damage',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="advancedFilters().damage?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'damage',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>

                <!-- Fire Rate Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{ 'weapons.filters.fireRate' | transloco }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="advancedFilters().fireRate?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'fireRate',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="advancedFilters().fireRate?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'fireRate',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>

                <!-- Magazine Size Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{
                                'weapons.filters.magazineSize' | transloco
                            }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="advancedFilters().magazineSize?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'magazineSize',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="advancedFilters().magazineSize?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'magazineSize',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>

                <!-- Encumbrance Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{
                                'weapons.filters.encumbrance' | transloco
                            }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="advancedFilters().encumbrance?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'encumbrance',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="advancedFilters().encumbrance?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'encumbrance',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>

                <!-- Price Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{ 'weapons.filters.price' | transloco }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="advancedFilters().price?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'price',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="advancedFilters().price?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'price',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>
            </div>

            <div
                class="flex flex-wrap items-center justify-between gap-4 border-t border-base-300 pt-4"
            >
                <!-- Exact Match Filters -->
                <div class="flex flex-wrap gap-4">
                    <label class="label cursor-pointer gap-2 py-0">
                        <input
                            type="checkbox"
                            class="checkbox checkbox-xs checkbox-primary"
                            [checked]="advancedFilters().suppressed === true"
                            (change)="
                                onExactFilter(
                                    'suppressed',
                                    $any($event.target).checked
                                        ? true
                                        : undefined
                                )
                            "
                        />
                        <span class="label-text text-xs">{{
                            'weapons.filters.suppressed' | transloco
                        }}</span>
                    </label>

                    <label class="label cursor-pointer gap-2 py-0">
                        <input
                            type="checkbox"
                            class="checkbox checkbox-xs checkbox-primary"
                            [checked]="
                                advancedFilters().canRespawnWith === true
                            "
                            (change)="
                                onExactFilter(
                                    'canRespawnWith',
                                    $any($event.target).checked
                                        ? true
                                        : undefined
                                )
                            "
                        />
                        <span class="label-text text-xs">{{
                            'weapons.filters.canRespawnWith' | transloco
                        }}</span>
                    </label>
                </div>

                <!-- Clear Filters Button -->
                <button
                    class="btn btn-ghost btn-xs text-error"
                    (click)="onClearFilters()"
                >
                    <i-lucide name="trash-2" class="h-3 w-3"></i-lucide>
                    {{ 'weapons.clearFilters' | transloco }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Error Alert -->
@if (hasError()) {
    <div class="alert alert-error mb-4 py-2 px-3 text-sm">
        <i-lucide name="alert-circle" class="h-4 w-4 shrink-0"></i-lucide>
        <span>{{ error() }}</span>
    </div>
}

<!-- Loading State -->
@if (loading()) {
    <div
        class="alert alert-info mb-4 py-2 px-3 text-sm bg-info/10 text-info border-info/20"
    >
        <span class="loading loading-spinner h-4 w-4"></span>
        <span>{{ 'weapons.scanning' | transloco }}</span>
    </div>
}

<!-- Weapons Table -->
<div class="border border-base-300 rounded-box bg-base-100 overflow-hidden">
    <!-- Header is rendered outside the virtual-scroll viewport to avoid sticky + transform issues -->
    <div class="sticky top-0 z-20 border-b border-base-300 bg-base-100">
        <div class="table-header-clip overflow-hidden">
            <table
                class="table table-xs w-max table-fixed table-header-table"
                [style.width.px]="tableWidthPx()"
                [style.minWidth.px]="tableWidthPx()"
                [style.transform]="headerTransform()"
            >
                <colgroup>
                    @for (col of visibleColumnsForDisplay(); track col.key) {
                        <col [style.width.px]="getColumnWidthPx(col.key)" />
                    }
                </colgroup>
                <thead>
                    <tr>
                        @for (
                            col of visibleColumnsForDisplay();
                            track col.key
                        ) {
                            <th
                                [class.text-right]="col.alignment === 'right'"
                                class="cursor-pointer hover:bg-base-200 transition-colors py-3 px-4"
                                [title]="
                                    'weapons.sort.' +
                                        (getColumnSortDirection(col.key) ||
                                            'unsorted') | transloco
                                "
                                (click)="onColumnClick(col.key)"
                            >
                                <div
                                    class="flex items-center gap-1"
                                    [class.justify-end]="
                                        col.alignment === 'right'
                                    "
                                >
                                    <span
                                        class="uppercase tracking-wider text-[10px] opacity-60"
                                        >{{ col.i18nKey | transloco }}</span
                                    >
                                    @if (
                                        getColumnSortDirection(col.key) ===
                                        'asc'
                                    ) {
                                        <i-lucide
                                            name="chevron-up"
                                            class="h-3 w-3 text-primary"
                                        ></i-lucide>
                                    } @else if (
                                        getColumnSortDirection(col.key) ===
                                        'desc'
                                    ) {
                                        <i-lucide
                                            name="chevron-down"
                                            class="h-3 w-3 text-primary"
                                        ></i-lucide>
                                    }
                                </div>
                            </th>
                        }
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <cdk-virtual-scroll-viewport
        #weaponsViewport
        class="h-[calc(100vh-420px)] w-full"
        (scroll)="onViewportScroll()"
        [itemSize]="rowHeight"
        [minBufferPx]="rowHeight * 8"
        [maxBufferPx]="rowHeight * 30"
    >
        <table
            class="table table-xs table-zebra w-max table-fixed"
            [style.width.px]="tableWidthPx()"
            [style.minWidth.px]="tableWidthPx()"
        >
            <colgroup>
                @for (col of visibleColumnsForDisplay(); track col.key) {
                    <col [style.width.px]="getColumnWidthPx(col.key)" />
                }
            </colgroup>
            <tbody>
                @if (weaponCount() === 0) {
                    <tr>
                        <td
                            [colSpan]="visibleColumnsForDisplay().length"
                            class="text-center py-20"
                        >
                            <div class="flex flex-col items-center opacity-20">
                                <i-lucide
                                    name="inbox"
                                    class="h-12 w-12 mb-2"
                                ></i-lucide>
                                <p>{{ 'weapons.noWeapons' | transloco }}</p>
                            </div>
                        </td>
                    </tr>
                } @else {
                    <tr
                        *cdkVirtualFor="
                            let weapon of paginatedWeapons();
                            trackBy: trackByWeaponId
                        "
                        class="cursor-pointer hover:bg-base-200 transition-colors group"
                        [class.bg-base-300]="
                            selectedWeapon()?.key === weapon.key
                        "
                        [class.border-l-2]="
                            selectedWeapon()?.key === weapon.key
                        "
                        [class.border-l-primary]="
                            selectedWeapon()?.key === weapon.key
                        "
                        (click)="selectWeapon(weapon)"
                    >
                        @for (
                            col of visibleColumnsForDisplay();
                            track col.key
                        ) {
                            <td
                                class="py-2 px-4"
                                [class.text-right]="col.alignment === 'right'"
                                [class.text-left]="col.alignment === 'left'"
                            >
                                @if (col.key === 'image') {
                                    <div
                                        class="w-10 h-10 bg-base-200/50 rounded flex items-center justify-center p-1 relative"
                                        [class.skeleton]="
                                            loadingIcons().has(weapon.key || '')
                                        "
                                    >
                                        @if (
                                            loadingIcons().has(weapon.key || '')
                                        ) {
                                            <i-lucide
                                                name="loader-2"
                                                class="absolute h-4 w-4 animate-spin text-base-content/50"
                                            ></i-lucide>
                                        }
                                        @if (getWeaponIconUrl(weapon)) {
                                            <img
                                                [src]="getWeaponIconUrl(weapon)"
                                                [alt]="weapon.name"
                                                class="max-w-full max-h-full object-contain"
                                                loading="lazy"
                                                (error)="onWeaponImageError()"
                                            />
                                        } @else if (
                                            !loadingIcons().has(
                                                weapon.key || ''
                                            )
                                        ) {
                                            <i-lucide
                                                name="image-off"
                                                class="w-5 h-5 opacity-20"
                                            />
                                        }
                                    </div>
                                } @else if (col.field === 'filePath') {
                                    <div
                                        class="flex items-center gap-1 group/path"
                                    >
                                        <span
                                            class="text-[10px] font-mono whitespace-normal break-all flex-1 opacity-60"
                                            [title]="weapon.filePath"
                                        >
                                            {{ weapon.filePath }}
                                        </span>
                                        <div
                                            class="flex opacity-0 group-hover:opacity-100 transition-opacity"
                                        >
                                            <button
                                                class="btn btn-ghost btn-xs btn-square h-6 w-6"
                                                [title]="
                                                    'weapons.actions.openInEditor'
                                                        | transloco
                                                "
                                                (click)="
                                                    $event.stopPropagation();
                                                    onOpenInEditor(weapon)
                                                "
                                            >
                                                <i-lucide
                                                    name="square-pen"
                                                    class="h-3 w-3"
                                                ></i-lucide>
                                            </button>
                                            <button
                                                class="btn btn-ghost btn-xs btn-square h-6 w-6"
                                                [title]="
                                                    'weapons.actions.copyPath'
                                                        | transloco
                                                "
                                                (click)="
                                                    $event.stopPropagation();
                                                    onCopyPath(weapon)
                                                "
                                            >
                                                <i-lucide
                                                    name="copy"
                                                    class="h-3 w-3"
                                                ></i-lucide>
                                            </button>
                                        </div>
                                    </div>
                                } @else if (col.field === 'name') {
                                    <span
                                        class="font-medium text-sm"
                                        [innerHTML]="highlight(weapon.name)"
                                    ></span>
                                } @else if (col.field === 'tag') {
                                    <span
                                        class="badge badge-ghost badge-sm font-mono text-[10px] opacity-70"
                                        [innerHTML]="highlight(weapon.tag)"
                                    ></span>
                                } @else if (col.field === 'key') {
                                    <span
                                        class="text-xs truncate block"
                                        [title]="weapon.key"
                                        [innerHTML]="highlight(weapon.key)"
                                    ></span>
                                } @else {
                                    <span class="text-xs">{{
                                        weapon[col.field]
                                    }}</span>
                                }
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </cdk-virtual-scroll-viewport>
</div>

<!-- Pagination Controls -->
@if (weaponCount() > 0) {
    <div
        class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-3 px-1"
    >
        <!-- Display Stats -->
        <div
            class="text-[10px] text-base-content/50 uppercase tracking-wider order-2 sm:order-1"
        >
            {{
                'weapons.pagination_info'
                    | transloco
                        : {
                              start: getDisplayRange().start,
                              end: getDisplayRange().end,
                              total: totalItems(),
                          }
            }}
            <span class="mx-2">|</span>
            {{ 'weapons.weaponCount' | transloco: { count: weaponCount() } }}
        </div>

        <!-- Page Navigation -->
        <div class="join order-1 sm:order-2 shadow-sm border border-base-300">
            <!-- Previous Button -->
            <button
                class="btn btn-xs join-item bg-base-100"
                [disabled]="pagination().currentPage === 1"
                [title]="'pagination.prev' | transloco"
                (click)="onPageChange(pagination().currentPage - 1)"
            >
                <i-lucide name="chevron-left" class="h-4 w-4"></i-lucide>
            </button>
            @for (page of getPageNumbers(); track page) {
                @if (page === -1) {
                    <button
                        class="btn btn-xs join-item pointer-events-none opacity-50 bg-base-100"
                    >
                        ...
                    </button>
                } @else {
                    <button
                        class="btn btn-xs join-item bg-base-100"
                        [class.btn-active]="page === pagination().currentPage"
                        [class.btn-primary]="page === pagination().currentPage"
                        (click)="onPageChange(page)"
                    >
                        {{ page }}
                    </button>
                }
            }
            <!-- Next Button -->
            <button
                class="btn btn-xs join-item bg-base-100"
                [disabled]="pagination().currentPage === totalPages()"
                [title]="'pagination.next' | transloco"
                (click)="onPageChange(pagination().currentPage + 1)"
            >
                <i-lucide name="chevron-right" class="h-4 w-4"></i-lucide>
            </button>
        </div>
    </div>
}

<!-- Drawer Overlay (click to close) -->
@if (isDetailPanelOpen()) {
    <div
        class="fixed inset-0 bg-black/30 z-50"
        (click)="closeDetailPanel()"
    ></div>
}

<!-- Detail Side Panel -->
@if (isDetailPanelOpen() && selectedWeapon()) {
    <aside
        @slideIn
        class="fixed top-0 right-0 w-[75%] min-w-[400px] h-screen bg-base-100 border-l border-base-300 shadow-2xl z-[100] flex flex-col"
    >
        <!-- Header -->
        <div
            class="flex justify-between items-center p-4 border-b border-base-300 bg-base-200/30"
        >
            <div class="flex items-center gap-3">
                <i-lucide name="info" class="h-5 w-5 text-primary"></i-lucide>
                <h3 class="font-bold text-lg tracking-tight">
                    {{ selectedWeapon()!.name }}
                </h3>
            </div>
            <button
                class="btn btn-sm btn-circle btn-ghost"
                (click)="closeDetailPanel()"
            >
                <i-lucide name="x" class="h-5 w-5"></i-lucide>
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 p-6 overflow-y-auto custom-scrollbar">
            <!-- Template Error Warning -->
            @if (selectedWeapon()!.templateError) {
                <div class="alert alert-warning mb-6 py-2 px-3 text-sm">
                    <i-lucide
                        name="alert-triangle"
                        class="h-5 w-5 shrink-0"
                    ></i-lucide>
                    <div>
                        <h4 class="font-bold text-xs">
                            {{ 'weapons.details.title' | transloco }} - Template
                            Error
                        </h4>
                        <p class="text-[10px]">
                            {{ selectedWeapon()!.templateError }}
                        </p>
                    </div>
                </div>
            }

            <!-- First row: Image + Basic Info -->
            <div class="flex gap-6 mb-8">
                <div class="flex-shrink-0">
                    <div
                        class="w-32 h-32 bg-base-200 rounded-xl shadow-inner border border-base-300 flex items-center justify-center p-4 relative"
                        [class.skeleton]="
                            loadingIcons().has(selectedWeapon()?.key || '')
                        "
                    >
                        @if (loadingIcons().has(selectedWeapon()?.key || '')) {
                            <i-lucide
                                name="loader-2"
                                class="absolute h-6 w-6 animate-spin text-base-content/50"
                            ></i-lucide>
                        }
                        @if (getWeaponIconUrl(selectedWeapon()!)) {
                            <img
                                [src]="getWeaponIconUrl(selectedWeapon()!)"
                                [alt]="selectedWeapon()!.name"
                                class="max-w-full max-h-full object-contain"
                                (error)="onWeaponImageError()"
                            />
                        } @else if (
                            !loadingIcons().has(selectedWeapon()?.key || '')
                        ) {
                            <i-lucide
                                [name]="
                                    getIconForWeaponType(
                                        selectedWeapon()!.tag || ''
                                    )
                                "
                                class="w-16 h-16 text-primary/40"
                            ></i-lucide>
                        }
                    </div>
                </div>

                <div class="flex-1 min-w-0 grid grid-cols-1 gap-4">
                    <div>
                        <span
                            class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                            >{{ 'weapons.columns.key' | transloco }}</span
                        >
                        <div
                            class="font-mono text-sm bg-base-200 py-1 px-2 rounded border border-base-300 truncate"
                        >
                            {{ selectedWeapon()!.key || '-' }}
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <span
                                class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                                >{{ 'weapons.columns.class' | transloco }}</span
                            >
                            <div class="text-sm font-medium">
                                {{ selectedWeapon()!.tag || '-' }}
                            </div>
                        </div>
                        <div class="flex-1">
                            <span
                                class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                                >{{
                                    'weapons.details.package' | transloco
                                }}</span
                            >
                            <div
                                class="text-sm font-medium truncate"
                                [title]="selectedWeapon()!.packageName"
                            >
                                {{ selectedWeapon()!.packageName }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Path -->
            <div class="mb-8 p-3 bg-base-200 rounded-lg border border-base-300">
                <span
                    class="text-[10px] uppercase font-bold opacity-40 block mb-2"
                    >{{ 'weapons.columns.filePath' | transloco }}</span
                >
                <div class="flex items-center gap-3">
                    <div class="text-xs font-mono break-all flex-1 opacity-70">
                        {{ selectedWeapon()!.filePath }}
                    </div>
                    <div class="flex gap-1">
                        <button
                            class="btn btn-ghost btn-xs btn-square"
                            (click)="onOpenInEditor(selectedWeapon()!)"
                        >
                            <i-lucide
                                name="square-pen"
                                class="h-4 w-4"
                            ></i-lucide>
                        </button>
                        <button
                            class="btn btn-ghost btn-xs btn-square"
                            (click)="onCopyPath(selectedWeapon()!)"
                        >
                            <i-lucide name="copy" class="h-4 w-4"></i-lucide>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Specifications -->
            <div class="mb-8">
                <h4
                    class="text-xs font-bold uppercase opacity-40 mb-3 tracking-widest"
                >
                    {{ 'weapons.details.specifications' | transloco }}
                </h4>
                <div class="grid grid-cols-2 gap-x-8 gap-y-2">
                    <div
                        class="flex justify-between border-b border-base-300 py-2"
                    >
                        <span class="text-sm opacity-70">{{
                            'weapons.columns.magazineSize' | transloco
                        }}</span>
                        <span class="font-mono font-bold">{{
                            selectedWeapon()!.magazineSize
                        }}</span>
                    </div>
                    <div
                        class="flex justify-between border-b border-base-300 py-2"
                    >
                        <span class="text-sm opacity-70">{{
                            'weapons.columns.killProbability' | transloco
                        }}</span>
                        <span class="font-mono font-bold">{{
                            selectedWeapon()!.killProbability
                        }}</span>
                    </div>
                    <div
                        class="flex justify-between border-b border-base-300 py-2"
                    >
                        <span class="text-sm opacity-70">{{
                            'weapons.columns.retriggerTime' | transloco
                        }}</span>
                        <span class="font-mono font-bold">{{
                            selectedWeapon()!.retriggerTime
                        }}</span>
                    </div>
                    @if (selectedWeapon()!.projectileSpeed) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'weapons.details.projectileSpeed' | transloco
                            }}</span>
                            <span class="font-mono font-bold">{{
                                selectedWeapon()!.projectileSpeed
                            }}</span>
                        </div>
                    }
                    @if (selectedWeapon()!.encumbrance) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'weapons.filters.encumbrance' | transloco
                            }}</span>
                            <span class="font-mono font-bold">{{
                                selectedWeapon()!.encumbrance
                            }}</span>
                        </div>
                    }
                    @if (selectedWeapon()!.price) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'weapons.filters.price' | transloco
                            }}</span>
                            <span class="font-mono font-bold text-success">{{
                                selectedWeapon()!.price
                            }}</span>
                        </div>
                    }
                </div>

                <div class="grid grid-cols-3 gap-4 mt-4">
                    <div
                        class="bg-base-200 p-3 rounded-lg border border-base-300 flex flex-col items-center"
                    >
                        <span class="text-[10px] uppercase opacity-40 mb-1">{{
                            'weapons.details.suppressed' | transloco
                        }}</span>
                        @if (selectedWeapon()!.suppressed) {
                            <i-lucide
                                name="check-circle"
                                class="h-5 w-5 text-success"
                            ></i-lucide>
                        } @else {
                            <i-lucide
                                name="x-circle"
                                class="h-5 w-5 opacity-20"
                            ></i-lucide>
                        }
                    </div>
                    <div
                        class="bg-base-200 p-3 rounded-lg border border-base-300 flex flex-col items-center"
                    >
                        <span class="text-[10px] uppercase opacity-40 mb-1">{{
                            'weapons.details.canRespawnWith' | transloco
                        }}</span>
                        @if (selectedWeapon()!.canRespawnWith) {
                            <i-lucide
                                name="check-circle"
                                class="h-5 w-5 text-success"
                            ></i-lucide>
                        } @else {
                            <i-lucide
                                name="x-circle"
                                class="h-5 w-5 opacity-20"
                            ></i-lucide>
                        }
                    </div>
                    <div
                        class="bg-base-200 p-3 rounded-lg border border-base-300 flex flex-col items-center"
                    >
                        <span class="text-[10px] uppercase opacity-40 mb-1">{{
                            'weapons.details.inStock' | transloco
                        }}</span>
                        @if (selectedWeapon()!.inStock) {
                            <i-lucide
                                name="check-circle"
                                class="h-5 w-5 text-success"
                            ></i-lucide>
                        } @else {
                            <i-lucide
                                name="x-circle"
                                class="h-5 w-5 opacity-20"
                            ></i-lucide>
                        }
                    </div>
                </div>
            </div>

            <!-- Stance Accuracies -->
            @if (selectedWeapon()!.stanceAccuracies.length > 0) {
                <div class="mb-8">
                    <h4
                        class="text-xs font-bold uppercase opacity-40 mb-3 tracking-widest"
                    >
                        {{ 'weapons.details.stanceAccuracies' | transloco }}
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        @for (
                            stance of selectedWeapon()!.stanceAccuracies;
                            track stance.stance
                        ) {
                            <div
                                class="flex justify-between items-center p-3 bg-base-200/50 rounded-lg border border-base-300"
                            >
                                <span class="text-sm font-medium">{{
                                    'weapons.details.stances.' + stance.stance
                                        | transloco
                                }}</span>
                                <span
                                    class="font-mono font-bold text-primary"
                                    >{{ stance.accuracy }}</span
                                >
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Chain Variants -->
            @if (selectedWeapon()!.chainVariants.length > 0) {
                <div class="mb-8">
                    <h4
                        class="text-xs font-bold uppercase opacity-40 mb-3 tracking-widest"
                    >
                        {{ 'weapons.details.chainVariants' | transloco }}
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        @for (
                            variant of selectedWeapon()!.chainVariants;
                            track variant
                        ) {
                            <span
                                class="badge badge-outline border-base-300 px-3 py-3 text-xs"
                                >{{ variant }}</span
                            >
                        }
                    </div>
                </div>
            }
        </div>
    </aside>
}
