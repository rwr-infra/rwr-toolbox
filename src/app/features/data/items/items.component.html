<div class="control-area">
    <!-- Search and Filter Group -->
    <div class="flex flex-1 gap-2 min-w-[300px]">
        <div class="join w-full">
            <div
                class="join-item flex items-center bg-base-100 border border-base-300 px-3"
            >
                <i-lucide name="search" class="h-4 w-4 opacity-50"></i-lucide>
            </div>
            <input
                type="text"
                [placeholder]="'items.search' | transloco"
                class="input input-bordered input-sm join-item flex-1"
                [value]="searchTerm()"
                (input)="onSearch($any($event.target).value)"
            />
            <select
                class="select select-bordered select-sm join-item w-40"
                (change)="onItemTypeFilter($any($event.target).value)"
            >
                <option value="">
                    {{ 'items.filters.allTypes' | transloco }}
                </option>
                @for (type of availableItemTypes(); track type) {
                    <option
                        [value]="type"
                        [selected]="selectedItemType() === type"
                    >
                        {{ 'items.filters.' + type | transloco }}
                    </option>
                }
            </select>
        </div>
    </div>

    <!-- Tools Group -->
    <div class="flex items-end gap-2">
        <!-- Page Size -->
        <div class="form-control">
            <label class="label py-0 h-4">
                <span class="label-text text-[10px] uppercase opacity-50">{{
                    'items.page_size' | transloco
                }}</span>
            </label>
            <select
                class="select select-bordered select-sm"
                [value]="pagination().pageSize"
                (change)="onPageSizeChange($event)"
            >
                @for (size of pageSizeOptions; track size) {
                    <option [value]="size">
                        {{ 'items.page_size_' + size | transloco }}
                    </option>
                }
            </select>
        </div>

        <!-- Column Toggle Dropdown -->
        <div class="dropdown dropdown-end">
            <div
                tabindex="0"
                role="button"
                class="btn btn-outline btn-sm"
                [title]="'items.column.selectColumns' | transloco"
            >
                <i-lucide name="settings-2" class="h-4 w-4"></i-lucide>
            </div>
            <ul
                tabindex="0"
                class="dropdown-content z-[10] menu p-2 shadow-lg bg-base-100 rounded-box w-52 border border-base-300"
            >
                <li class="menu-title">
                    <span class="text-[10px] uppercase opacity-50">{{
                        'items.column.selectColumns' | transloco
                    }}</span>
                </li>
                @for (col of columns; track col.key) {
                    <li>
                        <label
                            class="label cursor-pointer py-1 gap-2 justify-start"
                        >
                            <input
                                type="checkbox"
                                class="checkbox checkbox-xs checkbox-primary"
                                [checked]="isColumnVisible(col.key)"
                                [disabled]="isColumnDisabled(col.key)"
                                (change)="onColumnToggle(col.key)"
                            />
                            <span class="label-text text-xs">{{
                                col.i18nKey | transloco
                            }}</span>
                        </label>
                    </li>
                }
            </ul>
        </div>

        <!-- Scrolling Mode Toggle Button -->
        <button
            class="btn btn-outline btn-sm"
            (click)="toggleScrollingMode()"
            [title]="'scrolling.toggleTooltip' | transloco"
        >
            <i-lucide
                [name]="isTableOnlyMode() ? 'layout-list' : 'layout-grid'"
                class="h-4 w-4"
            ></i-lucide>
        </button>

        <!-- Refresh button -->
        <button class="btn btn-primary btn-sm" (click)="onRefresh()">
            @if (loading()) {
                <span class="loading loading-spinner h-4 w-4"></span>
            } @else {
                <i-lucide name="refresh-cw" class="h-4 w-4"></i-lucide>
            }
            {{ 'items.refresh' | transloco }}
        </button>
    </div>
</div>

<!-- Advanced Search Panel -->
<div
    class="bg-base-200/50 border border-base-300 mb-4 rounded-box overflow-hidden"
>
    <!-- Header Trigger -->
    <div
        (click)="toggleAdvancedSearch()"
        class="flex items-center justify-between p-4 cursor-pointer hover:bg-base-200/50 transition-colors"
    >
        <div class="text-sm font-medium flex items-center gap-2">
            <i-lucide name="layers" class="h-4 w-4 opacity-50"></i-lucide>
            {{ 'items.advancedSearch' | transloco }}
        </div>
        <i-lucide
            name="chevron-down"
            class="h-4 w-4 transition-transform duration-200"
            [class.rotate-180]="showAdvancedSearch()"
        ></i-lucide>
    </div>

    <!-- Animated Content Area -->
    <div [@expandCollapse]="showAdvancedSearch() ? 'expanded' : 'collapsed'">
        <div class="p-4 border-t border-base-300 overflow-visible">
            <!-- Range Filters -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                <!-- Encumbrance Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{ 'items.columns.encumbrance' | transloco }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="filters().encumbrance?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'encumbrance',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="filters().encumbrance?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'encumbrance',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>

                <!-- Price Range -->
                <div class="form-control">
                    <label class="label py-1">
                        <span
                            class="label-text text-[10px] uppercase opacity-50"
                            >{{ 'items.columns.price' | transloco }}</span
                        >
                    </label>
                    <div class="join w-full">
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Min"
                            [value]="filters().price?.min ?? ''"
                            (input)="
                                onRangeFilter(
                                    'price',
                                    'min',
                                    $any($event.target).value
                                )
                            "
                        />
                        <input
                            type="number"
                            class="input input-bordered input-xs join-item w-full"
                            placeholder="Max"
                            [value]="filters().price?.max ?? ''"
                            (input)="
                                onRangeFilter(
                                    'price',
                                    'max',
                                    $any($event.target).value
                                )
                            "
                        />
                    </div>
                </div>
            </div>

            <div
                class="flex flex-wrap items-center justify-between gap-4 border-t border-base-300 pt-4"
            >
                <!-- Exact Match Filters -->
                <div class="flex flex-wrap gap-4">
                    <label class="label cursor-pointer gap-2 py-0">
                        <input
                            type="checkbox"
                            class="checkbox checkbox-xs checkbox-primary"
                            [checked]="filters().canRespawnWith === true"
                            (change)="
                                onExactFilter(
                                    'canRespawnWith',
                                    $any($event.target).checked
                                        ? true
                                        : undefined
                                )
                            "
                        />
                        <span class="label-text text-xs">{{
                            'weapons.filters.canRespawnWith' | transloco
                        }}</span>
                    </label>

                    <label class="label cursor-pointer gap-2 py-0">
                        <input
                            type="checkbox"
                            class="checkbox checkbox-xs checkbox-primary"
                            [checked]="filters().inStock === true"
                            (change)="
                                onExactFilter(
                                    'inStock',
                                    $any($event.target).checked
                                        ? true
                                        : undefined
                                )
                            "
                        />
                        <span class="label-text text-xs">{{
                            'weapons.details.inStock' | transloco
                        }}</span>
                    </label>
                </div>

                <!-- Clear Filters Button -->
                <button
                    class="btn btn-ghost btn-xs text-error"
                    (click)="onClearFilters()"
                >
                    <i-lucide name="trash-2" class="h-3 w-3"></i-lucide>
                    {{ 'items.clearFilters' | transloco }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Error Alert -->
@if (hasError()) {
    <div class="alert alert-error mb-4 py-2 px-3 text-sm">
        <i-lucide name="alert-circle" class="h-4 w-4 shrink-0"></i-lucide>
        <span>{{ error() }}</span>
    </div>
}

<!-- Loading State -->
@if (loading()) {
    <div
        class="alert alert-info mb-4 py-2 px-3 text-sm bg-info/10 text-info border-info/20"
    >
        <span class="loading loading-spinner h-4 w-4"></span>
        <span>{{ 'items.scanning' | transloco }}</span>
    </div>
}

<!-- Items Table -->
<div class="border border-base-300 rounded-box bg-base-100 overflow-x-auto">
    <cdk-virtual-scroll-viewport
        #itemsViewport
        class="h-[calc(100vh-380px)] w-full"
        [itemSize]="rowHeight"
        [minBufferPx]="rowHeight * 8"
        [maxBufferPx]="rowHeight * 30"
    >
        <table class="table table-xs table-zebra table-pin-rows w-full">
            <thead>
                <tr>
                    @for (col of getVisibleColumns(); track col.key) {
                        <th
                            [class.text-right]="col.alignment === 'right'"
                            class="cursor-pointer hover:bg-base-200 transition-colors py-3 px-4"
                            [title]="
                                'items.sort.' +
                                    (getColumnSortDirection(col.key) ||
                                        'unsorted') | transloco
                            "
                            (click)="onColumnClick(col.key)"
                        >
                            <div
                                class="flex items-center gap-1"
                                [class.justify-end]="col.alignment === 'right'"
                            >
                                <span
                                    class="uppercase tracking-wider text-[10px] opacity-60"
                                    >{{ col.i18nKey | transloco }}</span
                                >
                                @if (
                                    getColumnSortDirection(col.key) === 'asc'
                                ) {
                                    <i-lucide
                                        name="chevron-up"
                                        class="h-3 w-3 text-primary"
                                    ></i-lucide>
                                } @else if (
                                    getColumnSortDirection(col.key) === 'desc'
                                ) {
                                    <i-lucide
                                        name="chevron-down"
                                        class="h-3 w-3 text-primary"
                                    ></i-lucide>
                                }
                            </div>
                        </th>
                    }
                </tr>
            </thead>
            <tbody>
                @if (itemCount() === 0) {
                    <tr>
                        <td
                            [colSpan]="getVisibleColumns().length"
                            class="text-center py-20"
                        >
                            <div class="flex flex-col items-center opacity-20">
                                <i-lucide
                                    name="inbox"
                                    class="h-12 w-12 mb-2"
                                ></i-lucide>
                                <p>{{ 'items.noItems' | transloco }}</p>
                            </div>
                        </td>
                    </tr>
                } @else {
                    <tr
                        *cdkVirtualFor="
                            let item of paginatedItems();
                            trackBy: trackByItemId
                        "
                        class="cursor-pointer hover:bg-base-200 transition-colors group"
                        [class.bg-base-300]="selectedItem()?.key === item.key"
                        [class.border-l-2]="selectedItem()?.key === item.key"
                        [class.border-l-primary]="
                            selectedItem()?.key === item.key
                        "
                        (click)="selectItem(item)"
                    >
                        @for (col of getVisibleColumns(); track col.key) {
                            <td
                                class="py-2 px-4"
                                [class.text-right]="col.alignment === 'right'"
                                [class.text-left]="col.alignment === 'left'"
                            >
                                @if (col.key === 'image') {
                                    <div
                                        class="w-10 h-10 bg-base-200/50 rounded flex items-center justify-center p-1"
                                        [class.skeleton]="
                                            loadingIcons().has(item.key || '')
                                        "
                                    >
                                        @if (getItemIconUrl(item)) {
                                            <img
                                                [src]="getItemIconUrl(item)"
                                                [alt]="item.name"
                                                class="max-w-full max-h-full object-contain"
                                                loading="lazy"
                                                (error)="onItemImageError()"
                                            />
                                        } @else if (
                                            !loadingIcons().has(item.key || '')
                                        ) {
                                            <i-lucide
                                                name="image-off"
                                                class="w-5 h-5 opacity-20"
                                            />
                                        }
                                    </div>
                                } @else if (col.field === 'filePath') {
                                    <div
                                        class="flex items-center gap-1 group/path"
                                    >
                                        <span
                                            class="text-[10px] font-mono truncate flex-1 opacity-60"
                                            [title]="item.filePath"
                                        >
                                            {{ item.filePath }}
                                        </span>
                                        <div
                                            class="flex opacity-0 group-hover:opacity-100 transition-opacity"
                                        >
                                            <button
                                                class="btn btn-ghost btn-xs btn-square h-6 w-6"
                                                [title]="
                                                    'items.actions.openInEditor'
                                                        | transloco
                                                "
                                                (click)="
                                                    $event.stopPropagation();
                                                    onOpenInEditor(item)
                                                "
                                            >
                                                <i-lucide
                                                    name="square-pen"
                                                    class="h-3 w-3"
                                                ></i-lucide>
                                            </button>
                                            <button
                                                class="btn btn-ghost btn-xs btn-square h-6 w-6"
                                                [title]="
                                                    'items.actions.copyPath'
                                                        | transloco
                                                "
                                                (click)="
                                                    $event.stopPropagation();
                                                    onCopyPath(item)
                                                "
                                            >
                                                <i-lucide
                                                    name="copy"
                                                    class="h-3 w-3"
                                                ></i-lucide>
                                            </button>
                                        </div>
                                    </div>
                                } @else if (col.field === 'name') {
                                    <span
                                        class="font-medium text-sm"
                                        [innerHTML]="highlight(item.name)"
                                    ></span>
                                } @else if (col.field === 'itemType') {
                                    <span
                                        class="badge badge-ghost badge-sm font-mono text-[10px] opacity-70"
                                        [innerHTML]="
                                            highlight(
                                                'items.filters.' + item.itemType
                                                    | transloco
                                            )
                                        "
                                    ></span>
                                } @else if (col.field === 'key') {
                                    <span
                                        class="text-xs"
                                        [innerHTML]="highlight(item.key)"
                                    ></span>
                                } @else if (col.field === 'capacity.value') {
                                    <span class="text-xs">{{
                                        getExtendedValue(item, 'capacity.value')
                                    }}</span>
                                } @else if (col.field === 'capacity.source') {
                                    <span class="text-xs">{{
                                        getExtendedValue(
                                            item,
                                            'capacity.source'
                                        )
                                    }}</span>
                                } @else if (col.field === 'commonness.value') {
                                    <span class="text-xs">{{
                                        getExtendedValue(
                                            item,
                                            'commonness.value'
                                        )
                                    }}</span>
                                } @else if (
                                    col.field === 'commonness.inStock'
                                ) {
                                    @if (
                                        getBooleanBadge(
                                            item,
                                            'commonness.inStock'
                                        ) === 'true'
                                    ) {
                                        <span
                                            class="badge badge-success badge-xs"
                                            >{{
                                                'common.yes' | transloco
                                            }}</span
                                        >
                                    } @else if (
                                        getBooleanBadge(
                                            item,
                                            'commonness.inStock'
                                        ) === 'false'
                                    ) {
                                        <span
                                            class="badge badge-error badge-xs"
                                            >{{ 'common.no' | transloco }}</span
                                        >
                                    } @else {
                                        <span class="opacity-20">-</span>
                                    }
                                } @else if (
                                    col.field === 'commonness.canRespawnWith'
                                ) {
                                    @if (
                                        getBooleanBadge(
                                            item,
                                            'commonness.canRespawnWith'
                                        ) === 'true'
                                    ) {
                                        <span
                                            class="badge badge-success badge-xs"
                                            >{{
                                                'common.yes' | transloco
                                            }}</span
                                        >
                                    } @else if (
                                        getBooleanBadge(
                                            item,
                                            'commonness.canRespawnWith'
                                        ) === 'false'
                                    ) {
                                        <span
                                            class="badge badge-error badge-xs"
                                            >{{ 'common.no' | transloco }}</span
                                        >
                                    } @else {
                                        <span class="opacity-20">-</span>
                                    }
                                } @else if (
                                    col.field === 'transformOnConsume'
                                ) {
                                    <span class="text-xs">{{
                                        getExtendedValue(
                                            item,
                                            'transformOnConsume'
                                        )
                                    }}</span>
                                } @else if (col.field === 'timeToLive') {
                                    <span class="text-xs">{{
                                        getExtendedValue(item, 'timeToLive')
                                    }}</span>
                                } @else if (col.field === 'draggable') {
                                    @if (
                                        getBooleanBadge(item, 'draggable') ===
                                        'true'
                                    ) {
                                        <span
                                            class="badge badge-success badge-xs"
                                            >{{
                                                'common.yes' | transloco
                                            }}</span
                                        >
                                    } @else if (
                                        getBooleanBadge(item, 'draggable') ===
                                        'false'
                                    ) {
                                        <span
                                            class="badge badge-ghost badge-xs"
                                            >{{ 'common.no' | transloco }}</span
                                        >
                                    } @else {
                                        <span class="opacity-20">-</span>
                                    }
                                } @else {
                                    <span class="text-xs">{{
                                        getColumnValue(item, col.key)
                                    }}</span>
                                }
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </cdk-virtual-scroll-viewport>
</div>

<!-- Pagination Controls -->
@if (itemCount() > 0) {
    <div
        class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-3 px-1"
    >
        <!-- Display Stats -->
        <div
            class="text-[10px] text-base-content/50 uppercase tracking-wider order-2 sm:order-1"
        >
            {{
                'items.pagination_info'
                    | transloco
                        : {
                              start: getDisplayRange().start,
                              end: getDisplayRange().end,
                              total: totalItems(),
                          }
            }}
            <span class="mx-2">|</span>
            {{ 'items.itemCount' | transloco: { count: itemCount() } }}
        </div>

        <!-- Page Navigation -->
        <div class="join order-1 sm:order-2 shadow-sm border border-base-300">
            @for (page of getPageNumbers(); track page) {
                @if (page === -1) {
                    <button
                        class="btn btn-xs join-item pointer-events-none opacity-50 bg-base-100"
                    >
                        ...
                    </button>
                } @else {
                    <button
                        class="btn btn-xs join-item bg-base-100"
                        [class.btn-active]="page === pagination().currentPage"
                        [class.btn-primary]="page === pagination().currentPage"
                        (click)="onPageChange(page)"
                    >
                        {{ page }}
                    </button>
                }
            }
        </div>
    </div>
}

<!-- Detail Side Panel -->
@if (isDetailPanelOpen() && selectedItem()) {
    <aside
        @slideIn
        class="fixed top-0 right-0 w-[75%] min-w-[400px] h-screen bg-base-100 border-l border-base-300 shadow-2xl z-[100] flex flex-col"
    >
        <!-- Header -->
        <div
            class="flex justify-between items-center p-4 border-b border-base-300 bg-base-200/30"
        >
            <div class="flex items-center gap-3">
                <i-lucide name="info" class="h-5 w-5 text-primary"></i-lucide>
                <h3 class="font-bold text-lg tracking-tight">
                    {{ selectedItem()!.name }}
                </h3>
            </div>
            <button
                class="btn btn-sm btn-circle btn-ghost"
                (click)="closeDetailPanel()"
            >
                <i-lucide name="x" class="h-5 w-5"></i-lucide>
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 p-6 overflow-y-auto custom-scrollbar">
            <!-- First row: Image + Basic Info -->
            <div class="flex gap-6 mb-8">
                <div class="flex-shrink-0">
                    <div
                        class="w-32 h-32 bg-base-200 rounded-xl shadow-inner border border-base-300 flex items-center justify-center p-4"
                        [class.skeleton]="
                            loadingIcons().has(selectedItem()?.key || '')
                        "
                    >
                        @if (getItemIconUrl(selectedItem()!)) {
                            <img
                                [src]="getItemIconUrl(selectedItem()!)"
                                [alt]="selectedItem()!.name"
                                class="max-w-full max-h-full object-contain"
                                (error)="onItemImageError()"
                            />
                        } @else if (
                            !loadingIcons().has(selectedItem()?.key || '')
                        ) {
                            <i-lucide
                                [name]="
                                    getIconForItemType(
                                        selectedItem()!.itemType || ''
                                    )
                                "
                                class="w-16 h-16 text-primary/40"
                            ></i-lucide>
                        }
                    </div>
                </div>

                <div class="flex-1 min-w-0 grid grid-cols-1 gap-4">
                    <div>
                        <span
                            class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                            >{{ 'items.columns.key' | transloco }}</span
                        >
                        <div
                            class="font-mono text-sm bg-base-200 py-1 px-2 rounded border border-base-300 truncate"
                        >
                            {{ selectedItem()!.key || '-' }}
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <span
                                class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                                >{{
                                    'items.columns.itemType' | transloco
                                }}</span
                            >
                            <div class="text-sm font-medium">
                                {{
                                    'items.filters.' + selectedItem()!.itemType
                                        | transloco
                                }}
                            </div>
                        </div>
                        <div class="flex-1">
                            <span
                                class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                                >{{
                                    'weapons.details.package' | transloco
                                }}</span
                            >
                            <div
                                class="text-sm font-medium truncate"
                                [title]="selectedItem()!.packageName"
                            >
                                {{ selectedItem()!.packageName }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Path -->
            <div class="mb-8 p-3 bg-base-200 rounded-lg border border-base-300">
                <span
                    class="text-[10px] uppercase font-bold opacity-40 block mb-2"
                    >{{ 'items.columns.filePath' | transloco }}</span
                >
                <div class="flex items-center gap-3">
                    <div class="text-xs font-mono break-all flex-1 opacity-70">
                        {{ selectedItem()!.filePath }}
                    </div>
                    <div class="flex gap-1">
                        <button
                            class="btn btn-ghost btn-xs btn-square"
                            (click)="onOpenInEditor(selectedItem()!)"
                        >
                            <i-lucide
                                name="square-pen"
                                class="h-4 w-4"
                            ></i-lucide>
                        </button>
                        <button
                            class="btn btn-ghost btn-xs btn-square"
                            (click)="onCopyPath(selectedItem()!)"
                        >
                            <i-lucide name="copy" class="h-4 w-4"></i-lucide>
                        </button>
                    </div>
                </div>
            </div>

            @if (getItemSlotValue()) {
                <div class="mb-8">
                    <span
                        class="text-[10px] uppercase font-bold opacity-40 block mb-1"
                        >{{ 'items.columns.slot' | transloco }}</span
                    >
                    <div class="text-sm font-medium">
                        {{ getItemSlotValue() }}
                    </div>
                </div>
            }

            <!-- Specifications -->
            <div class="mb-8">
                <h4
                    class="text-xs font-bold uppercase opacity-40 mb-3 tracking-widest"
                >
                    {{ 'weapons.details.specifications' | transloco }}
                </h4>
                <div class="grid grid-cols-2 gap-x-8 gap-y-2">
                    @if (
                        selectedItem()!.encumbrance !== null &&
                        selectedItem()!.encumbrance !== undefined
                    ) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'items.columns.encumbrance' | transloco
                            }}</span>
                            <span class="font-mono font-bold">{{
                                selectedItem()!.encumbrance
                            }}</span>
                        </div>
                    }
                    @if (
                        selectedItem()!.price !== null &&
                        selectedItem()!.price !== undefined
                    ) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'items.columns.price' | transloco
                            }}</span>
                            <span class="font-mono font-bold text-success">{{
                                selectedItem()!.price
                            }}</span>
                        </div>
                    }
                    @if (getTransformOnConsume(selectedItem()!)) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'items.columns.transformOnConsume' | transloco
                            }}</span>
                            <span class="text-sm font-medium">{{
                                getTransformOnConsume(selectedItem()!)
                            }}</span>
                        </div>
                    }
                    @if (
                        getTimeToLive(selectedItem()!) !== null &&
                        getTimeToLive(selectedItem()!) !== undefined
                    ) {
                        <div
                            class="flex justify-between border-b border-base-300 py-2"
                        >
                            <span class="text-sm opacity-70">{{
                                'items.columns.timeToLive' | transloco
                            }}</span>
                            <span class="font-mono font-bold">{{
                                getTimeToLive(selectedItem()!)
                            }}</span>
                        </div>
                    }
                </div>

                <div class="grid grid-cols-3 gap-4 mt-4">
                    <div
                        class="bg-base-200 p-3 rounded-lg border border-base-300 flex flex-col items-center"
                    >
                        <span
                            class="text-[10px] uppercase opacity-40 mb-1 text-center leading-tight h-6 flex items-center"
                            >{{
                                'weapons.details.canRespawnWith' | transloco
                            }}</span
                        >
                        @if (selectedItem()!.canRespawnWith) {
                            <i-lucide
                                name="check-circle"
                                class="h-5 w-5 text-success"
                            ></i-lucide>
                        } @else {
                            <i-lucide
                                name="x-circle"
                                class="h-5 w-5 opacity-20"
                            ></i-lucide>
                        }
                    </div>
                    <div
                        class="bg-base-200 p-3 rounded-lg border border-base-300 flex flex-col items-center"
                    >
                        <span
                            class="text-[10px] uppercase opacity-40 mb-1 text-center leading-tight h-6 flex items-center"
                            >{{ 'weapons.details.inStock' | transloco }}</span
                        >
                        @if (selectedItem()!.inStock) {
                            <i-lucide
                                name="check-circle"
                                class="h-5 w-5 text-success"
                            ></i-lucide>
                        } @else {
                            <i-lucide
                                name="x-circle"
                                class="h-5 w-5 opacity-20"
                            ></i-lucide>
                        }
                    </div>
                    <div
                        class="bg-base-200 p-3 rounded-lg border border-base-300 flex flex-col items-center"
                    >
                        <span
                            class="text-[10px] uppercase opacity-40 mb-1 text-center leading-tight h-6 flex items-center"
                            >{{ 'items.columns.draggable' | transloco }}</span
                        >
                        @if (getDraggable(selectedItem()!)) {
                            <i-lucide
                                name="check-circle"
                                class="h-5 w-5 text-success"
                            ></i-lucide>
                        } @else {
                            <i-lucide
                                name="x-circle"
                                class="h-5 w-5 opacity-20"
                            ></i-lucide>
                        }
                    </div>
                </div>
            </div>

            <!-- Extended Attributes -->
            @if (
                hasCapacity(selectedItem()!) ||
                hasCommonness(selectedItem()!) ||
                hasModifiers(selectedItem()!)
            ) {
                <div class="mb-8">
                    <h4
                        class="text-xs font-bold uppercase opacity-40 mb-3 tracking-widest"
                    >
                        Extended Attributes
                    </h4>
                    <div class="grid grid-cols-1 gap-2">
                        @if (hasCapacity(selectedItem()!)) {
                            <div
                                class="flex justify-between border-b border-base-300 py-2"
                            >
                                <span class="text-sm opacity-70">{{
                                    'items.columns.capacityValue' | transloco
                                }}</span>
                                <span class="font-mono font-bold">{{
                                    getExtendedValue(
                                        selectedItem()!,
                                        'capacity.value'
                                    )
                                }}</span>
                            </div>
                            <div
                                class="flex justify-between border-b border-base-300 py-2"
                            >
                                <span class="text-sm opacity-70">{{
                                    'items.columns.capacitySource' | transloco
                                }}</span>
                                <span class="text-sm font-medium">{{
                                    getExtendedValue(
                                        selectedItem()!,
                                        'capacity.source'
                                    )
                                }}</span>
                            </div>
                        }
                        @if (hasCommonness(selectedItem()!)) {
                            <div
                                class="flex justify-between border-b border-base-300 py-2"
                            >
                                <span class="text-sm opacity-70">{{
                                    'items.columns.commonnessValue' | transloco
                                }}</span>
                                <span class="font-mono font-bold">{{
                                    getExtendedValue(
                                        selectedItem()!,
                                        'commonness.value'
                                    )
                                }}</span>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Modifiers -->
            @if (hasModifiers(selectedItem()!)) {
                <div class="mb-8">
                    <h4
                        class="text-xs font-bold uppercase opacity-40 mb-3 tracking-widest"
                    >
                        {{ 'items.columns.modifiers' | transloco }}
                    </h4>
                    <div class="space-y-3">
                        @for (
                            modifier of getModifiers(selectedItem()!);
                            track modifier._id
                        ) {
                            <div
                                class="p-3 bg-base-200/50 rounded-lg border border-base-300"
                            >
                                <div
                                    class="flex justify-between items-center mb-2"
                                >
                                    <span class="text-xs font-bold font-mono">{{
                                        modifier.class || '(no class)'
                                    }}</span>
                                    @if (
                                        modifier.value !== undefined &&
                                        modifier.value !== null
                                    ) {
                                        <span
                                            class="badge badge-primary badge-sm"
                                            >{{ modifier.value }}</span
                                        >
                                    }
                                </div>
                                <div
                                    class="flex items-center justify-between text-[11px]"
                                >
                                    <div
                                        class="flex items-center gap-2 opacity-70"
                                    >
                                        <i-lucide
                                            name="activity"
                                            class="h-3 w-3"
                                        ></i-lucide>
                                        <span>{{
                                            modifier.inputCharacterState || '?'
                                        }}</span>
                                        <i-lucide
                                            name="arrow-right"
                                            class="h-2.5 w-2.5"
                                        ></i-lucide>
                                        <span>{{
                                            modifier.outputCharacterState || '?'
                                        }}</span>
                                    </div>
                                    @if (modifier.consumesItem) {
                                        <span
                                            class="text-warning font-bold flex items-center gap-1"
                                        >
                                            <i-lucide
                                                name="trash-2"
                                                class="h-3 w-3"
                                            ></i-lucide>
                                            CONSUMES
                                        </span>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </aside>
}
