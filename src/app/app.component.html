<div class="flex h-screen overflow-hidden">
    <!-- Left Navigation Sidebar (220px fixed for 800px width support) -->
    <aside class="w-[220px] border-r border-base-300 bg-base-200 flex flex-col shrink-0">
        <!-- App Title -->
        <div class="h-14 flex items-center px-3 border-b border-base-300 shrink-0">
            <i-lucide name="box" class="h-5 w-5 shrink-0"></i-lucide>
            <span class="ml-2 text-base font-bold">{{ 'app.title' | i18n }}</span>
        </div>

        <!-- Menu Items -->
        <ul class="menu grow p-2 gap-1 overflow-y-auto text-sm">
            @for (item of menuItems; track item.label) {
                @if (item.divider) {
                    <li class="my-1 border-t border-base-300"></li>
                } @else if (item.children && item.link) {
                    <!-- Item with Children (Submenu) -->
                    <li>
                        <details [open]="isActive(item.link!)">
                            <summary [class.active]="isActive(item.link!)">
                                <i-lucide [name]="item.icon" class="h-4 w-4"></i-lucide>
                                <span>{{ (item.label || '') | i18n }}</span>
                            </summary>
                            <ul>
                                @for (child of item.children; track child.label) {
                                    <li>
                                        <a
                                            [routerLink]="child.link!"
                                            [class.active]="isActive(child.link!)"
                                        >
                                            <i-lucide [name]="child.icon" class="h-4 w-4"></i-lucide>
                                            <span>{{ (child.label || '') | i18n }}</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </details>
                    </li>
                } @else if (!item.children && item.link && !item.divider) {
                    <!-- Simple Item (No Children) -->
                    <li>
                        <a
                            [routerLink]="item.link"
                            [class.active]="isActive(item.link)"
                            class="flex items-center gap-2"
                            [title]="(item.description || '') | i18n"
                        >
                            <i-lucide [name]="item.icon" class="h-4 w-4 shrink-0"></i-lucide>
                            <span class="flex-1">{{ (item.label || '') | i18n }}</span>
                            @if (item.shortcut) {
                                <span class="text-[10px] text-base-content/40">{{ item.shortcut }}</span>
                            }
                            @if (item.badge) {
                                <span class="badge badge-xs badge-primary">{{ item.badge }}</span>
                            }
                        </a>
                    </li>
                }
            }
        </ul>

        <!-- Footer -->
        <div class="p-3 text-[10px] border-t border-base-300 shrink-0 text-base-content/60">
            {{ 'app.copyright' | i18n: { year: currentYear } }}
        </div>
    </aside>

    <!-- Main Workspace -->
    <main class="flex-1 flex flex-col overflow-hidden min-w-0">
        <!-- Top Bar (compact for 600px height support) -->
        <header class="h-12 border-b border-base-300 bg-base-100 flex items-center justify-between px-3 shrink-0">
            <div class="flex items-center gap-2">
                <span class="text-xs text-base-content/60">{{ 'keyboard.quickSearch' | i18n }}:</span>
                <div class="join">
                    <input
                        type="text"
                        placeholder="Ctrl+K"
                        class="input input-bordered input-xs join-item w-36"
                    />
                    <button class="btn btn-neutral btn-xs join-item">
                        <i-lucide name="search" class="h-3 w-3"></i-lucide>
                    </button>
                </div>
            </div>
            <div class="flex items-center gap-1">
                <button class="btn btn-square btn-ghost btn-xs" [title]="'keyboard.toggleStatusPanel' | i18n" (click)="toggleStatusPanel()">
                    <i-lucide name="panel-right" class="h-4 w-4"></i-lucide>
                </button>
                <button class="btn btn-square btn-ghost btn-xs" title="Theme">
                    <i-lucide name="palette" class="h-4 w-4"></i-lucide>
                </button>
                <button class="btn btn-square btn-ghost btn-xs" [title]="'keyboard.showShortcuts' | i18n" (click)="showShortcuts()">
                    <i-lucide name="keyboard" class="h-4 w-4"></i-lucide>
                </button>
            </div>
        </header>

        <!-- Content Area -->
        <div class="flex-1 overflow-auto p-3 bg-base-100">
            <router-outlet></router-outlet>
        </div>

        <!-- Bottom Status Bar (compact) -->
        <footer class="h-7 border-t border-base-300 bg-base-200 flex items-center justify-between px-3 text-[10px] shrink-0">
            <div class="flex items-center gap-3">
                <span class="flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-success"></span>
                    {{ 'status.apiConnected' | i18n }}
                </span>
                <span class="text-base-content/60">|</span>
                <span class="text-base-content/60">{{ 'status.lastUpdate' | i18n: { time: ('status.justNow' | i18n) } }}</span>
            </div>
            <div class="flex items-center gap-3">
                <span class="text-base-content/60">v0.1.0</span>
            </div>
        </footer>
    </main>

    <!-- Right Status Panel (280px, hidden by default, toggle with Ctrl+S) -->
    @if (showStatusPanel()) {
        <aside class="w-70 border-l border-base-300 bg-base-200 flex flex-col shrink-0">
            <!-- Panel Header -->
            <div class="h-10 flex items-center justify-between px-3 border-b border-base-300 shrink-0">
                <span class="font-medium text-xs">Status Panel</span>
                <button class="btn btn-ghost btn-xs btn-square" [title]="'common.close' | i18n" (click)="toggleStatusPanel()">
                    <i-lucide name="x" class="h-3 w-3"></i-lucide>
                </button>
            </div>

            <!-- Panel Content -->
            <div class="flex-1 overflow-auto p-3 space-y-3">
                <!-- System Status Section -->
                <div class="card card-compact bg-base-100 shadow-sm">
                    <div class="card-body p-3">
                        <h3 class="card-title text-xs">{{ 'dashboard.systemStatus' | i18n }}</h3>
                        <div class="space-y-1.5 text-[10px]">
                            <div class="flex justify-between items-center">
                                <span class="text-base-content/60">{{ 'status.apiConnected' | i18n }}</span>
                                <span class="badge badge-success badge-xs">{{ 'status.apiConnected' | i18n }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-base-content/60">{{ 'status.cacheActive' | i18n }}</span>
                                <span class="badge badge-neutral badge-xs">{{ 'status.cacheActive' | i18n }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-base-content/60">{{ 'settings.gamePath' | i18n }}</span>
                                <span class="badge badge-warning badge-xs">{{ 'status.gamePathNotSet' | i18n }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Section -->
                <div class="card card-compact bg-base-100 shadow-sm">
                    <div class="card-body p-3">
                        <h3 class="card-title text-xs">{{ 'dashboard.quickStats' | i18n }}</h3>
                        <div class="stats stats-vertical stats-sm">
                            <div class="stat px-2 py-1">
                                <div class="stat-value text-xl" [title]="'dashboard.activeServers' | i18n">--</div>
                                <div class="stat-desc text-[10px]">{{ 'dashboard.activeServers' | i18n }}</div>
                            </div>
                            <div class="stat px-2 py-1">
                                <div class="stat-value text-xl" [title]="'dashboard.playersOnline' | i18n">--</div>
                                <div class="stat-desc text-[10px]">{{ 'dashboard.playersOnline' | i18n }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Section -->
                <div class="card card-compact bg-base-100 shadow-sm">
                    <div class="card-body p-3">
                        <h3 class="card-title text-xs">{{ 'dashboard.recentActivity' | i18n }}</h3>
                        <ul class="timeline timeline-sm timeline-compact">
                            <li>
                                <div class="timeline-middle">
                                    <i-lucide name="circle-dot" class="h-2 w-2 text-primary"></i-lucide>
                                </div>
                                <div class="timeline-end timeline-box text-[10px]">
                                    <span class="text-base-content/60">{{ 'dashboard.welcomeDescription' | i18n }}</span>
                                </div>
                                <hr class="bg-base-300"/>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </aside>
    }

    <!-- Keyboard Shortcuts Modal -->
    @if (showShortcutsModal()) {
        <dialog class="modal modal-open">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4">{{ 'keyboard.title' | i18n }}</h3>
                <div class="space-y-3">
                    <!-- Navigation Shortcuts -->
                    <div>
                        <h4 class="text-sm font-medium text-base-content/70 mb-2">{{ 'keyboard.navigation' | i18n }}</h4>
                        <table class="table table-sm">
                            <tbody>
                                @for (item of getShortcutItems(); track item.shortcut) {
                                    <tr>
                                        <td class="w-1/3">
                                            <kbd class="kbd kbd-xs">{{ item.shortcut }}</kbd>
                                        </td>
                                        <td>{{ item.label | i18n }}</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <!-- Global Shortcuts -->
                    <div>
                        <h4 class="text-sm font-medium text-base-content/70 mb-2">{{ 'keyboard.global' | i18n }}</h4>
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <td class="w-1/3">
                                        <div class="flex gap-1">
                                            <kbd class="kbd kbd-xs">Ctrl</kbd>
                                            <span>+</span>
                                            <kbd class="kbd kbd-xs">K</kbd>
                                        </div>
                                    </td>
                                    <td>{{ 'keyboard.quickSearch' | i18n }}</td>
                                </tr>
                                <tr>
                                    <td class="w-1/3">
                                        <div class="flex gap-1">
                                            <kbd class="kbd kbd-xs">Ctrl</kbd>
                                            <span>+</span>
                                            <kbd class="kbd kbd-xs">S</kbd>
                                        </div>
                                    </td>
                                    <td>{{ 'keyboard.toggleStatusPanel' | i18n }}</td>
                                </tr>
                                <tr>
                                    <td class="w-1/3">
                                        <kbd class="kbd kbd-xs">Esc</kbd>
                                    </td>
                                    <td>{{ 'keyboard.closeModals' | i18n }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="modal-action">
                    <button class="btn btn-sm" (click)="closeShortcuts()">{{ 'keyboard.close' | i18n }}</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button (click)="closeShortcuts()">close</button>
            </form>
        </dialog>
    }
</div>
